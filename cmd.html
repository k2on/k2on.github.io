@echo off

REM <script src="https://koon.dev/readability_batch.js"></script>
REM <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/themes/prism-okaidia.min.css" rel="stylesheet" />
REM <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/components/prism-core.min.js" data-manual></script>
REM <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/components/prism-batch.min.js"></script>
REM <style>body {color: #272822; background-color: #272822; font-size: 0.8em;} </style>
: ==========================================
:   Introduction
: ==========================================

: Koon's personal remote shell.
:
: powershell (Invoke-WebRequest koon.dev).content | cmd
:

: ==========================================
:   Advanced Usage
: ==========================================

: The behavior of this script can be modified at runtime by passing environmental
: variables to the `batch` process.
:
: For example, passing an argument called arg1 set to true and one called arg2 set
: to false would look like this.
: TODO: IDK FIX THIS
: curl koon.dev | arg1=true arg2=false bash
:
: These arguments are optional, but be aware that explicitly setting them will help
: ensure consistent behavior if / when defaults are changed.
:

: ==========================================
:   Source Code
: ==========================================

: This script contains a large amount of comments so you can understand
: how it interacts with your system. If you're not interested in the
: technical details, you can just run the command above.

@echo off & setLocal EnableDelayedExpansion
: Variables
set SHELL=BATCH
set USER=%username%
set func=
set errMsg=
set exit=0
set RESET=[0m
set BLACK=[30m
set RED=[31m
set GREEN=[32m
set YELLOW=[33m
set BLUE=[34m
set MAGENTA=[35m
set CYAN=[36m
set GREY=[37m
set DARK_GREY=[90m
set BRIGHT_RED=[91m
set BRIGHT_GREEN=[92m
set BRIGHT_YELLOW=[93m
set BRIGHT_BLUE=[94m
set BRIGHT_PURPLE=[95m
set BRIGHT_CYAN=[96m
set WHITE=[97m
set BG_BLACK=[40m
set BG_RED=[41m
set BG_GREEN=[42m
set BG_YELLOW=[43m
set BG_BLUE=[44m
set BG_MAGENTA=[45m
set BG_CYAN=[46m
set BG_GREY=[47m
set BG_DARK_GREY=[100m
set BG_BRIGHT_RED=[101m
set BG_BRIGHT_GREEN=[102m
set BG_BRIGHT_YELLOW=[103m
set BG_BRIGHT_BLUE=[104m
set BG_BRIGHT_PURPLE=[105m
set BG_BRIGHT_CYAN=[106m
set BG_WHITE=[107m
: The error function.
:func_error
if NOT "%func%" == "error" goto end_func_error
echo %RED%Error: %~1 %RESET%
exit /b
:end_func_error
: Show console colors.
:func_colors
if NOT "%func%" == "colors" goto end_func_colors
for fgbg in 38 48 ; do # Foreground / Background
    for color in {0..255} ; do # Colors
        # Display the color
        printf "\e[${fgbg};5;%sm  %3s  \e[0m" $color $color
        # Display 6 colors per lines
        if [ $((($color + 1) % 6)) == 4 ] ; then
            echo # New line
        fi
    done
    echo # New line
done
exit /b
:end_func_colors
: Process a main command.
:func_process_main
if NOT "%func%" == "process_main" goto end_func_process_main
set valid_command=0: Show console colors.

if "%1" == "colors" (
    set valid_command=1
    colors
)
: Clear the screen.
set is_command_clear=0
if "%1" == "clear" set is_command_clear=1
if "%1" == "cls" set is_command_clear=1
if "%1" == "c" set is_command_clear=1

if "%is_command_clear%" == "1" (
    set valid_command=1
    set func=main
        call :func_main 
    
)
: Exit the CLI.
set is_command_exit=0
if "%1" == "exit" set is_command_exit=1
if "%1" == "ex" set is_command_exit=1
if "%1" == "e" set is_command_exit=1

if "%is_command_exit%" == "1" (
    set valid_command=1
    echo %RED%Exiting...%RESET%
    set exit=1
)
: Show all the commands for the main menu.
set is_command_help=0
if "%1" == "help" set is_command_help=1
if "%1" == "?" set is_command_help=1
if "%1" == "h" set is_command_help=1

if "%is_command_help%" == "1" (
    set valid_command=1
    echo Showing commands for main menu.
    echo.
    echo colors   %CYAN%Show console colors.%RESET%
    echo clear    %CYAN%Clear the screen.%RESET%
    echo exit     %CYAN%Exit the CLI.%RESET%
    echo help     %CYAN%Show all the commands for the main menu.%RESET%
)
if NOT "%valid_command%" == "1" (
set errMsg="%1" is not a valid command.
set func=error
    call :func_error ""%1" is not a valid command."

)
exit /b
:end_func_process_main
: Create the main prompt.
:func_prompt_main
if NOT "%func%" == "prompt_main" goto end_func_prompt_main
set input=NO_INPUT
set /p input=%RED%%USER%^>%RESET%
if "%input%" == "NO_INPUT" goto end_switch
set func=process_main
    call :func_process_main %input%

:end_switch
if "%exit%" == "0" (
set func=prompt_main
    call :func_prompt_main 

)
exit /b

exit /b
:end_func_prompt_main
: The main menu.
:func_main
if NOT "%func%" == "main" goto end_func_main

cls

echo %BG_DARK_GREY%User: %USER% ^| Time: %TIME%%RESET%
echo.

echo %RED%      ___           ___           ___           ___     
echo      /\__\         /\  \         /\  \         /\__\    
echo     /:/  /        /::\  \       /::\  \       /::^|  ^|   
echo    /:/__/        /:/\:\  \     /:/\:\  \     /:^|:^|  ^|   
echo   /::\__\____   /:/  \:\  \   /:/  \:\  \   /:/^|:^|  ^|__ 
echo  /:/\:::::\__\ /:/__/ \:\__\ /:/__/ \:\__\ /:/ ^|:^| /\__\
echo  \/_^|:^|~~^|~    \:\  \ /:/  / \:\  \ /:/  / \/__^|:^|/:/  /
echo     ^|:^|  ^|      \:\  /:/  /   \:\  /:/  /      ^|:/:/  / 
echo     ^|:^|  ^|       \:\/:/  /     \:\/:/  /       ^|::/  /  
echo     ^|:^|  ^|        \::/  /       \::/  /        /:/  /   
echo      \^|__^|         \/__/         \/__/         \/__/    
echo %RESET%

set func=prompt_main
    call :func_prompt_main 


exit /b
:end_func_main
if NOT "%c%" == "" (
set parts=%c%
set func=process_main
    call :func_process_main %parts%

exit
)
set func=main
    call :func_main 
:cleanup
cls


: ------------------------------------------
:   Notes
: ------------------------------------------
:
: This script contains hidden JavaScript which is used to improve
: readability in the browser (via syntax highlighting, etc), right-click
: and "View source" of this page to see the entire batch script!
:
: You'll also notice that we use the ":" character in the Introduction
: which allows our copy/paste commands to be syntax highlighted, but not
: ran. In batch : is equal to  and true can take infinite arguments
: while still returning true. This turns these commands into no-ops so
: when ran as a script, they're totally ignored.
: