#!/usr/bin/env bash

## <script src="./readability.js"></script>
## <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/themes/prism-okaidia.min.css" rel="stylesheet" />
## <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/components/prism-core.min.js" data-manual></script>
## <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/components/prism-bash.min.js"></script>
## <style>body {color: #272822; background-color: #272822; font-size: 0.8em;} </style>
: ==========================================
:   Introduction
: ==========================================

# This script sets up my .zshrc profile
#
: curl -sL koon.dev | bash
#

: ==========================================
:   Advanced Usage
: ==========================================

# The behavior of this script can be modified at runtime by passing environmental
# variables to the `bash` process.
#
# For example, passing an argument called arg1 set to true and one called arg2 set
# to false would look like this.
#
: curl -sL koon.dev | arg1=true arg2=false bash
#
# These arguments are optional, but be aware that explicitly setting them will help
# ensure consistent behavior if / when defaults are changed.
#

: ==========================================
:   Source Code
: ==========================================

# This script contains a large amount of comments so you can understand
# how it interacts with your system. If you're not interested in the
# technical details, you can just run the command above.

#!/usr/bin/env bash

# Helper function creating menus.
function select_option {

    # little helpers for terminal print control and key input
    ESC=$( printf "\033")
    cursor_blink_on()  { printf "$ESC[?25h"; }
    cursor_blink_off() { printf "$ESC[?25l"; }
    cursor_to()        { printf "$ESC[$1;${2:-1}H"; }
    print_option()     { printf "   $1 "; }
    print_selected()   { printf "  $ESC[7m $1 $ESC[27m"; }
    get_cursor_row()   { IFS=';' read -sdR -p $'\E[6n' ROW COL; echo ${ROW#*[}; }
    key_input()        { read -s -n3 key 2>/dev/null >&2
                         if [[ $key = $ESC[A ]]; then echo up;    fi
                         if [[ $key = $ESC[B ]]; then echo down;  fi
                         if [[ $key = ""     ]]; then echo enter; fi; }

    # initially print empty new lines (scroll down if at bottom of screen)
    for opt; do printf "\n"; done

    # determine current screen position for overwriting the options
    local lastrow=`get_cursor_row`
    local startrow=$(($lastrow - $#))

    # ensure cursor and input echoing back on upon a ctrl+c during read -s
    trap "cursor_blink_on; stty echo; printf '\n'; exit" 2
    cursor_blink_off

    local selected=0
    while true; do
        # print options by overwriting the last lines
        local idx=0
        for opt; do
            cursor_to $(($startrow + $idx))
            if [ $idx -eq $selected ]; then
                print_selected "$opt"
            else
                print_option "$opt"
            fi
            ((idx++))
        done

        # user key control
        case `key_input` in
            enter) break;;
            up)    ((selected--));
                   if [ $selected -lt 0 ]; then selected=$(($# - 1)); fi;;
            down)  ((selected++));
                   if [ $selected -ge $# ]; then selected=0; fi;;
        esac
    done

    # cursor position back to normal
    cursor_to $lastrow
    printf "\n"
    cursor_blink_on

    return $selected
}

colors ()
{
    for fgbg in 38 48 ; do # Foreground / Background
        for color in {0..255} ; do # Colors
            # Display the color
            printf "\e[${fgbg};5;%sm  %3s  \e[0m" $color $color
            # Display 6 colors per lines
            if [ $((($color + 1) % 6)) == 4 ] ; then
                echo # New line
            fi
        done
        echo # New line
    done
    
}

# Install ZSH function
install_zsh ()
{

    # ZSH setup
    echo "Downloading your ZSH profile"

    # Set the download URL
    DOWNLOAD_URL="https://koon.dev/zshrc.sh"

    # Download the profile to the .zshrc file
    curl -o "$HOME/.zshrc" -L --progress-bar $DOWNLOAD_URL

    echo "ZSH profile set up!"

    # Success
    echo ""
    echo "✨ All done!"

    exit 0
}

# Colors
RESET='\e[0m'
CYAN='\e[96m'
PURPLE='\e[95m'

# Set IFS to nothing to preserve new lines
IFS=
# Create a splash screen
splash="
$CYAN██$PURPLE╗  $CYAN██$PURPLE╗ $CYAN██████$PURPLE╗  $CYAN██████$PURPLE╗ $CYAN███$PURPLE╗   $CYAN██$PURPLE╗$CYAN████████$PURPLE╗$CYAN██$PURPLE╗$CYAN██$PURPLE╗     
$CYAN██$PURPLE║ $CYAN██$PURPLE╔╝$CYAN██$PURPLE╔═══$CYAN██$PURPLE╗$CYAN██$PURPLE╔═══$CYAN██$PURPLE╗$CYAN████$PURPLE╗  $CYAN██$PURPLE║╚══$CYAN██$PURPLE╔══╝$CYAN██$PURPLE║$CYAN██$PURPLE║     
$CYAN█████$PURPLE╔╝ $CYAN██$PURPLE║   $CYAN██$PURPLE║$CYAN██$PURPLE║   $CYAN██$PURPLE║$CYAN██$PURPLE╔$CYAN██$PURPLE╗ $CYAN██$PURPLE║   $CYAN██$PURPLE║   $CYAN██$PURPLE║$CYAN██$PURPLE║     
$CYAN██$PURPLE╔═$CYAN██$PURPLE╗ $CYAN██$PURPLE║   $CYAN██$PURPLE║$CYAN██$PURPLE║   $CYAN██$PURPLE║$CYAN██$PURPLE║╚$CYAN██$PURPLE╗$CYAN██$PURPLE║   $CYAN██$PURPLE║   $CYAN██$PURPLE║$CYAN██$PURPLE║     
$CYAN██$PURPLE║  $CYAN██$PURPLE╗╚$CYAN██████$PURPLE╔╝╚$CYAN██████$PURPLE╔╝$CYAN██$PURPLE║ ╚$CYAN████$PURPLE║   $CYAN██$PURPLE║   $CYAN██$PURPLE║$CYAN███████$PURPLE╗
$PURPLE╚═╝  ╚═╝ ╚═════╝  ╚═════╝ ╚═╝  ╚═══╝   ╚═╝   ╚═╝╚══════╝$RESET"

USERNAME=$(whoami)
user_label="anon@$USERNAME"
token=

header () 
{
    time_string=`date "+%m/%d/%Y %H:%M:%S"`
    echo "User: $user_label  |  Time: $time_string
    "
}


# Create the main menu
prompt ()
{

    clear
    header

    echo -e $splash    
    echo ""
    echo "               ╔════[KOONTIL]════"
    read -p "               ╚═> " command

    if [ $command = "france" ]
    then
        start 'https://www.youtube.com/watch?v=v74vH3LjSuo'
    fi

    # colors

}

prompt

# ------------------------------------------
#   Notes
# ------------------------------------------
#
# This script contains hidden JavaScript which is used to improve
# readability in the browser (via syntax highlighting, etc), right-click
# and "View source" of this page to see the entire bash script!
#
# You'll also notice that we use the ":" character in the Introduction
# which allows our copy/paste commands to be syntax highlighted, but not
# ran. In bash : is equal to  and true can take infinite arguments
# while still returning true. This turns these commands into no-ops so
# when ran as a script, they're totally ignored.
#
